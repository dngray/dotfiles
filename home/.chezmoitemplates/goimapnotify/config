{{- $type := (vault (printf "kv/users/%s/mail" .currVaultID)).data.data.type -}}
{{- $user := index (vault (printf "kv/users/%s/mail" .currVaultID)).data.data.mail .accIdx -}}
{
  "host": "{{ $user.imapHost }}",
  "hostCmd": "",
  "port": {{ $user.imapPort }},
  "tls": true,
  "tlsOptions": {
    "rejectUnauthorized": true
  },
  "username": "{{ $user.username }}",
  "usernameCmd": "",
  "password": "",
  "passwordCmd": "gopass -o mail/{{ $user.accountName }}",
  "xoauth2": false,
  "onNewMail": "mbsync {{ $user.accountName }}-inbox",
  "onNewMailPost": "notmuch --config ~/.config/notmuch/{{ $type }}.conf new",
  "wait": 20,
  "boxes": [
    "Inbox"
  ]
}
