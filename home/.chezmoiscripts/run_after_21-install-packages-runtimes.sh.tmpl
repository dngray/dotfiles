#!/bin/bash

set -eufo pipefail

{{ $rust_pkgs := list
     "starship"
     "tree-sitter-cli" -}}

{{- if (vault (printf "kv/users/%s/packages" .profiles.a)).data.data.rust_pkgs }}
{{    range $rust_pkgs }}
cargo install {{ . }} --locked
{{-   end }}
{{- end }}

{{- if .state.private -}}

{{-   $golang_pkgs := list
        "github.com/gopasspw/gopass@latest" -}}

{{-   if and (eq .chezmoi.osRelease.id "debian") (eq .chezmoi.username "user") -}}
{{-     $golang_pkgs = concat $golang_pkgs (list
          "github.com/gopasspw/git-credential-gopass@latest") -}}
{{-   end }}
{{-   if (vault (printf "kv/users/%s/packages" .profiles.a)).data.data.golang_pkgs }}
{{      range $golang_pkgs }}
go install  {{ . }}
{{-     end }}
{{-   end }}

{{ $npm_pkgs := list
     "markdownlint-cli2" -}}

{{-   if (vault (printf "kv/users/%s/packages" .profiles.a)).data.data.npm_pkgs }}
{{      range $npm_pkgs }}
npm install {{ . }} --global
{{-     end }}
{{-   end }}
{{- end }}
